function searchFlytrap(e){const t=e.target.value;document.querySelector(".file-list-container");["Shift","Control"].includes(e.key)||(fetch("ajax/search.php?q="+t,{method:"get"}).then(e=>{if(e.status>=200&&e.status<300)return e.text()}).then(e=>JSON.parse(e)).then(e=>{for(item in document.querySelector(".files.flexbox").innerHTML="",e)addNewFile(e[item])}),"Enter"==e.key&&(location.href="/search?q="+t))}function addNewFile(e){console.log(e),document.querySelector(".files.flexbox").innerHTML+=`<li id = ${e[0]}><a href><img src = 'images/microphone.png'><p>${e[1]}</p></a><div class = 'customize-btns'>\t<button class="rename-audio"><img class="grey-circle" src="http://cdn.bforborum.com/images/Edit.png"></button><button class="delete-audio"><img class="grey-circle" src="http://cdn.bforborum.com/images/Delete.png"></button><button class="share-audio"><img class="grey-circle" src="http://cdn.bforborum.com/images/register.png"></button></div></li>`,handleShareBox(),handleDeleteBox(),handleNewFileBox(),handleRenameBox()}function exitPopup(e){e.target.parentElement.style.display="none"}function uploadFile(e){const t=document.getElementById("upload-file-progress-bar"),o=new FormData;for(let e in this.files)if(this.files.hasOwnProperty(e)){const n=this.files[e];if(o.append("file"+e,n),!["audio/wav","audio/x-wav","audio/mp3","audio/mpeg"].includes(n.type))return void displayStatus("You may only upload an audio file!");if(n.size>1e7)return void displayStatus("max upload size is 10 MB");t.style.display="inline-block"}sendFiles(o)}function sendFiles(e){let t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),console.log(document.getElementById("audio-files"));function o(e){document.getElementById("upload-file-progress-bar").value=e.loaded}t.open("POST","ajax/uploadaudio.php",!0),t.overrideMimeType("multipart/form-data"),t.addEventListener("loadstart",o),function e(t){t>90||(document.getElementById("upload-file-progress-bar").value=t,setTimeout(function(){e(t+1)},200))}(1),t.addEventListener("loadend",o),t.addEventListener("error",o),t.addEventListener("abort",o),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(toggleDisplay("none",1),toggleDisabled(!1),document.getElementById("upload-file-progress-bar").style.display="none",displayStatus(t.responseText))},t.send(e)}function displayStatus(e){document.querySelector(".status-container").classList.add("show-status"),document.querySelector(".status-container").style.display="block",document.querySelector(".status-container").innerHTML=e,setTimeout(function(){document.querySelector(".status-container").classList.remove("show-status"),document.querySelector(".status-container").classList.add("hide-status")},2e3)}document.getElementById("search-bar").onkeyup=searchFlytrap,document.querySelectorAll(".action-container img").forEach((e,t)=>{e.onclick=exitPopup,e.onkeydown=(e=>{console.log(e),"Escape"==e.key&&exitPopup(e)})}),document.querySelector('.new-file-box-container form input[name="file"]').onchange=uploadFile;
