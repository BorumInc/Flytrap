function searchFlytrap(e){const t=e.target.value;document.querySelector(".file-list-container");["Shift","Control"].includes(e.key)||(fetch("ajax/search.php?q="+t,{method:"get"}).then(e=>{if(e.status>=200&&e.status<300)return e.text()}).then(e=>JSON.parse(e)).then(e=>{for(item of(document.querySelector(".files.flexbox").innerHTML="",document.querySelector(".folders.flexbox").innerHTML="",document.querySelector("table.files tbody").innerHTML="",document.querySelector("table.folders tbody").innerHTML="",console.log("Add New File Data: "),console.log(e[0]),e[0]))addNewFile(item);for(item of(console.log("Add New Folder Data: "),console.log(e[1]),e[1]))addNewFolder(item)}),"Enter"==e.key&&(location.href="/search?q="+t))}function createNewFolder(e){const t=window.location.href.includes("folder")?"?parent_id="+window.location.href.substring(window.location.href.length-10):"";fetch("/ajax/newfolder.php"+t,{method:"get"}).then(e=>{if(e.status>=200&&e.status<300)return e.text()}).then(e=>JSON.parse(e)).then(e=>{1==e.length&&window.displayStatus(e[0]),addNewFolder({afid:e[2],0:e[1],1:e[3]})})}function addNewFolder(e){document.querySelector(".folders.flexbox").innerHTML+=`<li id = "folder-${e[0]}"><a href = "/folders/${e.afid}">${e[1]}</a><div class = 'customize-btns'><button class = 'rename-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Edit.png'></button><button class = 'delete-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Delete.png'></button><button class = 'share-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/register.png'></button></div></li>`,document.querySelector("table.folders tbody").innerHTML+=`<tr id = "folder-${e[0]}">\n\t\t<td><a href = 'folders/${e.afid}'>${e.folder_name}</a></td>\n\t\t<td>${e.time_created}</td>\n\t\t<td class = 'customize-btns'>\n\t\t\t<button class = 'rename-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Edit.png'></button>\n\t\t\t<button class = 'delete-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Delete.png'></button>\n\t\t\t<button class = 'share-folder'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/register.png'></button>\n\t\t</td>\n\t</tr>`,handleActionBox("share","folder"),handleActionBox("delete","folder"),handleActionBox("rename","folder")}function addNewFile(e){document.querySelector(".files.flexbox").innerHTML+=`<li id = 'file-${e[0]}'><a href = "/audio/${e.afid}"><img src = '/images/microphone.png'><p>${e.file_name}</p></a><div class = 'customize-btns'>\t<button class="rename-audio"><img class="grey-circle" src="https://cdn.bforborum.com/images/Edit.png"></button><button class="delete-audio"><img class="grey-circle" src="https://cdn.bforborum.com/images/Delete.png"></button><button class="share-audio"><img class="grey-circle" src="https://cdn.bforborum.com/images/register.png"></button></div></li>`,document.querySelector("table.files tbody").innerHTML+=`<tr id = "file-${e[0]}"><td><a href = "audio/${e.afid}">${e.file_name}</a></td><td>${e.time_created}</td><td class = 'customize-btns'><button class = 'rename-audio'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Edit.png'></button><button class = 'delete-audio'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/Delete.png'></button><button class = 'share-audio'><img class = 'grey-circle' src = 'https://cdn.bforborum.com/images/register.png'></button></td>\n\t</tr>`,handleActionBox("share","audio"),handleActionBox("delete","audio"),handleActionBox("rename","audio")}function exitPopup(e){e.target.parentElement.style.display="none"}function uploadFile(e){const t=document.getElementById("upload-file-progress-bar"),o=new FormData;for(let e in this.files)if(this.files.hasOwnProperty(e)){const n=this.files[e];if(o.append("file"+e,n),!["audio/wav","audio/x-wav","audio/mp3","audio/mpeg"].includes(n.type))return void displayStatus("You may only upload an audio file!");if(n.size>1e7)return void displayStatus("max upload size is 10 MB");t.style.display="inline-block"}sendFiles(o)}function sendFiles(e){let t;function o(e){document.getElementById("upload-file-progress-bar").value=e.loaded}(t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("POST","/ajax/uploadaudio.php",!0),t.overrideMimeType("multipart/form-data"),t.addEventListener("loadstart",o),function e(t){t>90||(document.getElementById("upload-file-progress-bar").value=t,setTimeout(function(){e(t+1)},200))}(1),t.addEventListener("loadend",o),t.addEventListener("error",o),t.addEventListener("abort",o),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(toggleDisplay("none",1),toggleDisabled(!1),document.getElementById("upload-file-progress-bar").style.display="none",displayStatus(t.responseText))},t.send(e)}function displayStatus(e){document.querySelector(".status-container").classList.remove("hide-status"),document.querySelector(".status-container").classList.add("show-status"),document.querySelector(".status-container").style.display="block",document.querySelector(".status-container").innerHTML=e,setTimeout(function(){document.querySelector(".status-container").classList.remove("show-status"),document.querySelector(".status-container").classList.add("hide-status")},2e3)}function onDragStart(e){e.dataTransfer.setData("text/plain",e.target.id),e.currentTarget.style.backgroundColor="yellow"}function onDragOver(e){e.preventDefault(),"true"==e.target.getAttribute("draggable")?e.dataTransfer.dropEffect="none":e.dataTransfer.dropEffect="all"}function onDrop(e){const t=e.dataTransfer.getData("text");if(t.includes("microphone-")){const o=document.getElementById(t);let n=e.target.closest("li").id.substring("folder-".length),a=o.parentElement.parentElement.id.substring("file-".length);console.log("Folder ID: "+n+", File ID: "+a),e.dataTransfer.clearData(),moveFolder(n,a)}}function moveFolder(e,t,o="0"){fetch("/ajax/moveaudio.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`new_folder=${e}&file_id=${t}&convert=${o}`}).then(e=>{if(e.status>=200&&e.status<300)return e.text()}).then(e=>{window.displayStatus(e)})}function moveDragOver(e){e.target.src="/images/openbox.png",onDragOver(e)}function moveDrop(e){e.target.src="/images/closedbox.png",onDrop(e)}function onDragEnd(e){e.currentTarget.style.background="none"}document.getElementById("search-bar").onkeyup=searchFlytrap,document.querySelectorAll(".action-container img").forEach((e,t)=>{e.onclick=exitPopup,e.onkeydown=(e=>{"Escape"==e.key&&exitPopup(e)})}),document.querySelector('.new-file-box-container form input[name="file"]').onchange=uploadFile,showBoxBtnEl=document.getElementsByClassName("advanced-btn")[0];const advancedMoveBox=document.getElementsByClassName("change-id-container")[0];function handleAdvancedMoveItem(){let e=!1;const t=e=>!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length);function o(e){!advancedMoveBox.contains(e.target)&&t(advancedMoveBox)&&(toggleDisplay2("none",1),toggleDisabled2(!1),document.removeEventListener("click",o))}showBoxBtnEl&&advancedMoveBox&&(showBoxBtnEl.addEventListener("click",function(){e||(event.preventDefault(),event.stopPropagation(),toggleDisplay2("block",.5),toggleDisabled2(!0),advancedMoveBox.querySelector("input").value="https://audio.bforborum.com/folders/",document.addEventListener("click",o))}),advancedMoveBox.querySelectorAll(".file-list-container ul li").forEach((e,t)=>{e.onclick=(t=>{e.style.outline="black solid 3px"==e.style.outline?"none":"3px solid black",e.classList.add("selected")})}))}function toggleDisplay2(e,t){document.querySelectorAll(".grid > div:not(.change-id-container)").forEach((e,o)=>{e.style.opacity=t}),advancedMoveBox.style.display=e}function toggleDisabled2(e){showBoxBtnEl.attributes.disabled=e,isDisabled=e}function moveAdvancedItem(){const e=document.querySelectorAll(".change-id-container .file-list-container .files .selected");let t=document.querySelector(".change-id-container input").value.substring("https://audio.bforborum.com/folders/".length),o=3;""==t&&(t=0,o=0),e.forEach((e,n)=>{let a=e.id.substring("file-".length);moveFolder(t,a,o)}),document.querySelector(".change-id-container").style.display="none",toggleDisplay2("none",1),toggleDisabled2(!1)}handleAdvancedMoveItem();
